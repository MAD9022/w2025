<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4.1 Messaging and Mobile Considerations | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" type="image/svg" href="/w2025/assets/javascript.svg">
    <link rel="shortcut icon" type="image/svg" href="/w2025/assets/javascript.svg">
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/w2025/assets/css/0.styles.33415ee0.css" as="style"><link rel="preload" href="/w2025/assets/js/app.87c858a9.js" as="script"><link rel="preload" href="/w2025/assets/js/2.ccdb61a5.js" as="script"><link rel="preload" href="/w2025/assets/js/36.3d9064e0.js" as="script"><link rel="preload" href="/w2025/assets/js/9.01890ce5.js" as="script"><link rel="preload" href="/w2025/assets/js/11.5fe5a40b.js" as="script"><link rel="prefetch" href="/w2025/assets/js/10.3e691a48.js"><link rel="prefetch" href="/w2025/assets/js/12.f49551e7.js"><link rel="prefetch" href="/w2025/assets/js/13.d5974a84.js"><link rel="prefetch" href="/w2025/assets/js/14.32f7e6e8.js"><link rel="prefetch" href="/w2025/assets/js/15.0ae027c8.js"><link rel="prefetch" href="/w2025/assets/js/16.f2386a1e.js"><link rel="prefetch" href="/w2025/assets/js/17.d7b9d534.js"><link rel="prefetch" href="/w2025/assets/js/18.7c15b945.js"><link rel="prefetch" href="/w2025/assets/js/19.51980183.js"><link rel="prefetch" href="/w2025/assets/js/20.d519c082.js"><link rel="prefetch" href="/w2025/assets/js/21.362f6b8c.js"><link rel="prefetch" href="/w2025/assets/js/22.afaf2123.js"><link rel="prefetch" href="/w2025/assets/js/23.cdc2c887.js"><link rel="prefetch" href="/w2025/assets/js/24.9b75b7c6.js"><link rel="prefetch" href="/w2025/assets/js/25.e357a328.js"><link rel="prefetch" href="/w2025/assets/js/26.6e814142.js"><link rel="prefetch" href="/w2025/assets/js/27.106c07bd.js"><link rel="prefetch" href="/w2025/assets/js/28.126c37bf.js"><link rel="prefetch" href="/w2025/assets/js/29.ca946c51.js"><link rel="prefetch" href="/w2025/assets/js/3.05989ff3.js"><link rel="prefetch" href="/w2025/assets/js/30.2ba498f6.js"><link rel="prefetch" href="/w2025/assets/js/31.e41d2241.js"><link rel="prefetch" href="/w2025/assets/js/32.cfce5625.js"><link rel="prefetch" href="/w2025/assets/js/33.3dc1268c.js"><link rel="prefetch" href="/w2025/assets/js/34.a3793153.js"><link rel="prefetch" href="/w2025/assets/js/35.ab1290f2.js"><link rel="prefetch" href="/w2025/assets/js/37.2ae4164b.js"><link rel="prefetch" href="/w2025/assets/js/38.195bef2c.js"><link rel="prefetch" href="/w2025/assets/js/39.a9904a96.js"><link rel="prefetch" href="/w2025/assets/js/4.79533d7f.js"><link rel="prefetch" href="/w2025/assets/js/40.1c93503b.js"><link rel="prefetch" href="/w2025/assets/js/41.61991e2b.js"><link rel="prefetch" href="/w2025/assets/js/42.87d5cabf.js"><link rel="prefetch" href="/w2025/assets/js/43.d8a479ef.js"><link rel="prefetch" href="/w2025/assets/js/44.8446907e.js"><link rel="prefetch" href="/w2025/assets/js/45.d1e73d03.js"><link rel="prefetch" href="/w2025/assets/js/46.14dd0c4d.js"><link rel="prefetch" href="/w2025/assets/js/47.6eae941d.js"><link rel="prefetch" href="/w2025/assets/js/48.4b257292.js"><link rel="prefetch" href="/w2025/assets/js/49.7c622f43.js"><link rel="prefetch" href="/w2025/assets/js/5.60adfd1c.js"><link rel="prefetch" href="/w2025/assets/js/50.5cc4788b.js"><link rel="prefetch" href="/w2025/assets/js/51.345ce69e.js"><link rel="prefetch" href="/w2025/assets/js/52.59f792c0.js"><link rel="prefetch" href="/w2025/assets/js/53.9344eea4.js"><link rel="prefetch" href="/w2025/assets/js/6.96402398.js"><link rel="prefetch" href="/w2025/assets/js/7.956989e6.js"><link rel="prefetch" href="/w2025/assets/js/8.62f5a92b.js">
    <link rel="stylesheet" href="/w2025/assets/css/0.styles.33415ee0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/w2025/" class="home-link router-link-active"><img src="/w2025/mad-d-logo-sm.png" alt="MAD9022" class="logo"> <span class="site-name can-hide">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/w2025/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2025/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2025/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/w2025/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2025/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2025/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>PWA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/w2025/modules/pwas/week1/1.1/" class="sidebar-link">1.1: Course Intro &amp; Review</a></li><li><a href="/w2025/modules/pwas/week1/1.2/" class="sidebar-link">1.2: Review Topics</a></li><li><a href="/w2025/modules/pwas/week2/2.1/" class="sidebar-link">2.1: Single Page Applications</a></li><li><a href="/w2025/modules/pwas/week2/2.2/" class="sidebar-link">2.2: SPA &amp; Coding Practices</a></li><li><a href="/w2025/modules/pwas/week3/3.1/" class="sidebar-link">3.1: Workers &amp; Service Workers</a></li><li><a href="/w2025/modules/pwas/week3/3.2/" class="sidebar-link">3.2: Service Worker Events</a></li><li><a href="/w2025/modules/pwas/week4/4.1/" aria-current="page" class="active sidebar-link">4.1: Messaging</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week4/4.1/#messaging" class="sidebar-link">Messaging</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week4/4.1/#broadcast-messaging" class="sidebar-link">Broadcast Messaging</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week4/4.1/#channel-messaging" class="sidebar-link">Channel Messaging</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week4/4.1/#client-messaging" class="sidebar-link">Client Messaging</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week4/4.1/#page-visibility-api" class="sidebar-link">Page Visibility API</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week4/4.1/#fullscreen-api" class="sidebar-link">FullScreen API</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week4/4.1/#screenorientation-api" class="sidebar-link">ScreenOrientation API</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week4/4.1/#deviceorientation-api" class="sidebar-link">DeviceOrientation API</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week4/4.1/#todo-this-week" class="sidebar-link">ToDo This Week</a></li></ul></li><li><a href="/w2025/modules/pwas/week4/4.2/" class="sidebar-link">4.2: Intro to PWAs</a></li><li><a href="/w2025/modules/pwas/week5/5.1/" class="sidebar-link">5.1: PWAs Continued</a></li><li><a href="/w2025/modules/pwas/week5/5.2/" class="sidebar-link">5.2: IndexedDB &amp; Data</a></li><li><a href="/w2025/modules/pwas/week6/6.1/" class="sidebar-link">6.1: Hosting Projects</a></li><li><a href="/w2025/modules/pwas/week6/6.2/" class="sidebar-link">6.2: PWA Project</a></li><li><a href="/w2025/modules/pwas/week7/7.1/" class="sidebar-link">7.1: Git Pull Requests</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title red">
    PWA
  </div> <h1>4.1 Messaging and Mobile Considerations</h1> <div class="underdev no">Module Still Under Development</div></header> <h2 id="messaging"><a href="#messaging" class="header-anchor">#</a> Messaging</h2> <p>To be able to change the functionality of your Service Worker depending on whether or not the browser is online or offline, we need to first test for the online status and then pass that information between the webpage and the Service Worker.</p> <p>More note <a href="/w2025/modules/pwas/week4/4.2/#online-and-offline-events">notes about online and offline events are in Module 4.2</a>.</p> <p>Once you have a status for the webpage being online or offline (usually a boolean variable), then you need to pass a message from the page to the Service Worker with that status.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> isOnline <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token comment">//initial status when your page loads</span>
<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//then use the online and offline events to change isOnline</span>
  <span class="token comment">//then send a message to the service worker with the new value</span>
  isOnline <span class="token operator">=</span> <span class="token string">'onLine'</span> <span class="token keyword">in</span> navigator <span class="token operator">&amp;&amp;</span> navigator<span class="token punctuation">.</span>onLine<span class="token punctuation">,</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span><span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>ready<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">reg</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token comment">//connected to an active service worker</span>
      <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">isOnline</span><span class="token operator">:</span> isOnline<span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">//send a message about online or offline if you want...</span>
      reg<span class="token punctuation">.</span>active<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>Each script, the main and the Service Worker, should have their own variable that holds a value indicating the online status. Then we use one of the messaging techniques to pass that value between the two scripts.</p> <p>There are several different ways to send messages from the script to the service worker. These techniques can also be used to send messages between open windows or tabs that belong to the same domain.</p> <p>The <strong>message</strong> that you send between the scripts can be a String, Number, Boolean, null, Array or Object. Basically, anything that you can convert into or from JSON.</p> <h2 id="broadcast-messaging"><a href="#broadcast-messaging" class="header-anchor">#</a> Broadcast Messaging</h2> <p>Broadcast Messaging is like a radio station, which broadcasts on a specific frequency and any other page, tab, or worker from the same domain can listen for messages.</p> <p>In your main script create a <code>BroadcastChannel</code> that you can use to send and receive messages from your script. Your channel object can listen for <code>message</code> events. Your channel object also has a <code>postMessage()</code> method that will broadcast your message.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//app.js</span>
<span class="token keyword">let</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BroadcastChannel</span><span class="token punctuation">(</span><span class="token string">'wkrp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//listen for broadcasted messages</span>
  channel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> gotMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">gotMessage</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//this runs when receiving a message</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ev <span class="token operator">&amp;&amp;</span> ev<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//this runs when you need to send a message</span>
  <span class="token comment">//messages can be any object that could be turned into JSON (serializable)</span>
  <span class="token keyword">let</span> theMessage <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'Some information'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  channel<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>theMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Broadcast Messaging can also be useful when you want to keep multiple webpages in sync and you are not using a service worker. In the situation where a user has multiple tabs open to the same website you can use Broadcast Messaging to tell all the other tabs when something happens on the current tab. Combine this with the <code>Page Visibility API</code> to manage your web app.</p> <div title="Broadcast Messaging API" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/n2NeCLTUMTE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="channel-messaging"><a href="#channel-messaging" class="header-anchor">#</a> Channel Messaging</h2> <p><code>Broadcast</code> messaging is sending a message out to anyone who is listening within the browser on the same domain. <code>Channel</code> messaging is a way to create a <strong>pair</strong> of clients that can talk to one
another. For example, a main script and a service worker.</p> <p>This process starts with the main script creating a <code>MessageChannel</code> object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//app.js</span>
<span class="token keyword">let</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//use the channel ports here as desired</span>
  <span class="token comment">//save references to port1 and port2 if desired</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Next you need to access the two <code>port</code> objects inside that <code>MessageChannel</code>. <code>port1</code> is used by the main script to receive messages from the service worker (or other tab|window). <code>port2</code> is sent to the service worker from the main script with a message direct to the active service worker.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//app.js</span>

<span class="token comment">//after registering the service worker, get the active worker</span>
navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>ready<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//send the port2 to the sw inside the second parameter in an array</span>
  <span class="token comment">//the array will be accessed as a property called `ports`</span>
  reg<span class="token punctuation">.</span>active<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'PORT'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>channel<span class="token punctuation">.</span>port2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//the message object {type:'PORT'} is just an identifier for the service worker</span>
  <span class="token comment">//so it knows it is receiving a port object</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>In the service worker you will receive this message with the standard <code>message</code> event listener and then set up the listener for the port that is passed in.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//sw.js</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'message received in sw'</span><span class="token punctuation">,</span> ev<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">&amp;&amp;</span> ev<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'PORT'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>ports<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//the array from the postMessage() method</span>
    <span class="token keyword">let</span> port <span class="token operator">=</span> ev<span class="token punctuation">.</span>ports<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'ports received'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//now add a listener to the port</span>
    port<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> gotMessage<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>The listener in your main script, for incoming messages from the service worker, is put on <code>port1</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//app.js</span>

channel<span class="token punctuation">.</span>port1<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> gotMessage<span class="token punctuation">;</span>
<span class="token comment">//gotMessage is our function that listens for messages from the service worker</span>
<span class="token comment">/**
alternative to
channel.port1.addEventListener('message', gotMessage);
if you use channel.port1.addEventListener
then you also need to call channel.port1.start()
to open the port and start sending messages.
**/</span>

<span class="token function">gotMessage</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message <span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//message received from service worker</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div title="Channel Messaging API" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/V8zQhH59trs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="client-messaging"><a href="#client-messaging" class="header-anchor">#</a> Client Messaging</h2> <p>The third way to send messages is by using the <code>postMessage()</code> method of the <code>Client</code> interface. this is actually what we did above to pass the <code>port2</code> object from the main script to the service worker.</p> <p>Sending messages from the main script to the service worker is just this:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//app.js</span>
<span class="token comment">//TO SEND MESSAGES TO THE SERVICE WORKER...</span>
navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>ready<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//the messageObj is your data object that gets passed to the service worker</span>
  reg<span class="token punctuation">.</span>active<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>messageObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//TO LISTEN FOR MESSAGES FROM OTHER WINDOWS/TABS</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> gotMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//TO LISTEN FOR MESSAGES FROM THE SERVICE WORKER</span>
navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> gotMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>In the service worker it will be received as a property called <code>data</code> on the message event.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//sw.js</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> messageObj <span class="token operator">=</span> ev<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token comment">//all client messages are received like this inside the service worker</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>source<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//ev.source.id is the id of the window client who sent the message to the service worker</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Any tab from the same origin can send a message to the service worker with the <code>postMessage</code> method. When the service worker receives the message event, then the <code>ev.data</code> property is the message object that was sent from the window. The <code>ev.source.id</code> property is the client id of the window which sent the message to the service worker.</p> <p>To <strong>send</strong> a message using <code>Client</code> messaging is a bit more work.</p> <p>When you have a <code>fetch</code> event occur in the service worker there should be a property on the event called <code>ev.clientId</code>. This is the identifying id for the window client that sent the message (from your main script).</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//works for `message` event too</span>
  <span class="token comment">//after doing other things... if you want to send a message</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>clientId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the client object.</span>
    <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">await</span> clients<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>clientId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> client</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//this function will send a message to ONE specific client</span>
  client<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>If you want to get the single clientId from the event then the property that you use depends on which event it is. The <code>fetch</code> event has a <code>clientId</code> property. The <code>message</code> event has a <code>source</code> property that contains an <code>id</code> property with the clientId.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>clientId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>source<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The challenging part comes when you want to send a message to ALL the connected clients.</p> <p>It is very possible for a user to have multiple tabs open for the same website. All these tabs will be sharing the same service worker. If you need to keep things in sync across all those tabs, then it is very likely that you will need to send the same message to all the tabs from the service worker at the same time. Each of those tabs will be running their own copy of the main script. They will each receive and handle their own copy of the message.</p> <p>But how do we send a message to each of the tabs (clients)?</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//sw.js</span>
<span class="token comment">//send a message to all connected clients</span>
<span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//same message being sent to all clients</span>
  <span class="token comment">//clients.matchAll() will find all the clients of this service worker</span>
  clients<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">clientList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> client <span class="token keyword">of</span> clientList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//loop through each of the clients</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>id<span class="token punctuation">,</span> client<span class="token punctuation">.</span>type<span class="token punctuation">,</span> client<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//id - the unique id for the client</span>
      <span class="token comment">//type - window, worker, or sharedworker</span>
      <span class="token comment">//url - url of the client window</span>
      client<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>The <code>clients.matchAll()</code> method can be passed an options object with a <code>type</code> property. The default is <code>{type: 'window'}</code> but you can change it to <code>all</code> or <code>worker</code> or <code>sharedworker</code>.</p> <div title="clients api and window messaging" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/LcNN0gcB4vw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="Service Workers - messaging between tabs" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/ISBjiYYqx6s" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <p>If you only want to send the message to selected window clients, then you can compare the the fetch event's <code>ev.clientId</code> or the message event's <code>ev.source.id</code> against the list of window client ids that are sharing the service worker.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//msg is the message object to send</span>
<span class="token comment">//clientID is the client id coming from the message or fetch event</span>
<span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> clientID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  clients<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">clientList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> client <span class="token keyword">of</span> clientList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>id <span class="token operator">===</span> clientID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//replying to one specific client id</span>
        client<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'back to the window that triggered the fetch or message event'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//replying to all the other clients</span>
        client<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'to all windows except the one that triggered the fetch or message event'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="page-visibility-api"><a href="#page-visibility-api" class="header-anchor">#</a> Page Visibility API</h2> <p>As a user switches between tabs or open windows, you can use the <code>Page Visibility API</code> to keep track of when your page comes into focus or loses focus.</p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Page_Visibility_API" target="_blank" rel="noopener noreferrer">Page Visibility API reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div title="Page Visibility API" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/MxF2WKAGWVk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="fullscreen-api"><a href="#fullscreen-api" class="header-anchor">#</a> FullScreen API</h2> <p>To manage the permissions and toggling in and out of fullscreen mode, you can use the <code>FullScreen API</code>. There are two parts to this.</p> <p>First, we need to determine the current state of the document. When we full-screen some element, the <code>fullscreenElement</code> property of the document object is assigned a reference to this full-screened element.</p> <p>If nothing is currently assigned then we can request that something be selected with the <code>requestFullscreen()</code> method. This method is promise based. If it fails you need to catch the error.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#myElement'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>document<span class="token punctuation">.</span>fullscreenElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  elem<span class="token punctuation">.</span><span class="token function">requestFullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error attempting to enable fullscreen mode: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">exitFullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>When you are done, you can call the <code>document.exitFullscreen()</code> method to put everything back to its original state.</p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API" target="_blank" rel="noopener noreferrer">FullScreen API reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div title="FullScreen API" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/aEpQxlKDbwU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="screenorientation-api"><a href="#screenorientation-api" class="header-anchor">#</a> ScreenOrientation API</h2> <p>As of 2023 this has changed. There used to be an <code>orientationchange</code> event that we listened for as a trigger to change things on the page.</p> <p>Now, we use the newer <code>change</code> event on the <code>window.screen.orientation</code> object, like the following sample.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>screen<span class="token punctuation">.</span>orientation<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> type <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
  <span class="token keyword">const</span> angle <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>angle<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ScreenOrientation change: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>angle<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> degrees.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/ScreenOrientation" target="_blank" rel="noopener noreferrer">Reference for the newer ScreenOrientation API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="deviceorientation-api"><a href="#deviceorientation-api" class="header-anchor">#</a> DeviceOrientation API</h2> <p>If you actually want to work with data that is coming from the accelerometer on the mobile device (not laptops), then you should use the Device Orientation API.</p> <p>There is a <code>deviceorientation</code> event that you can attach to the window object for data coming from the accelerometer.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'deviceorientation'</span><span class="token punctuation">,</span> handleOrientation<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleOrientation</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> absolute <span class="token operator">=</span> ev<span class="token punctuation">.</span>absolute<span class="token punctuation">;</span>
  <span class="token keyword">const</span> alpha <span class="token operator">=</span> ev<span class="token punctuation">.</span>alpha<span class="token punctuation">;</span>
  <span class="token keyword">const</span> beta <span class="token operator">=</span> ev<span class="token punctuation">.</span>beta<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gamma <span class="token operator">=</span> ev<span class="token punctuation">.</span>gamma<span class="token punctuation">;</span>

  <span class="token comment">// Do stuff with the new orientation data</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>The event object will contain 4 main properties that we care about.</p> <ul><li><code>alpha</code> which is motion around the z-axis, represented in degrees with values ranging from 0 (inclusive) to 360 (exclusive). Imaging a pin sticking through the middle of the screen and out the back of the device. Rotation around that pin is rotation around the z-axis.</li> <li><code>beta</code> which is motion of the device around the x-axis, represented in degrees with values ranging from -180 (inclusive) to 180 (exclusive). This represents a front to back motion of the device, as if the user is angling the top of the screen closer to or away from themselves.</li> <li><code>gamma</code> which is motion of the device around the y-axis, represented in degrees with values ranging from -90 (inclusive) to 90 (exclusive). Think of this as rotating the device to show the person sitting beside you.</li> <li><code>absolute</code> is a read-only boolean that, when true, means that the motion data is measured relative to the earth, and when false, it is relative to some other arbitrary frame determined by the device. <a href="https://developer.mozilla.org/en-US/docs/Web/API/Device_orientation_events/Orientation_and_motion_data_explained" target="_blank" rel="noopener noreferrer">This article on MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> explains how measurement values and reference frames work.</li></ul> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Device_orientation_events" target="_blank" rel="noopener noreferrer">Device Orientation API reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="todo-this-week"><a href="#todo-this-week" class="header-anchor">#</a> ToDo This Week</h2> <div class="custom-block danger"><p class="custom-block-title">To Do this week</p> <ul><li>read all the content for modules 4.1 and 4.2</li> <li>work on SPA assignment part 2</li> <li>work on the next Hybrid exercise</li></ul></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/w2025/modules/pwas/week3/3.2/" class="prev">
        3.2: Service Worker Events
      </a></span> <span class="next"><a href="/w2025/modules/pwas/week4/4.2/">
        4.2: Intro to PWAs
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/w2025/assets/js/app.87c858a9.js" defer></script><script src="/w2025/assets/js/2.ccdb61a5.js" defer></script><script src="/w2025/assets/js/36.3d9064e0.js" defer></script><script src="/w2025/assets/js/9.01890ce5.js" defer></script><script src="/w2025/assets/js/11.5fe5a40b.js" defer></script>
  </body>
</html>
