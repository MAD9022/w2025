<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2.2 SPA &amp; Coding Practices | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" type="image/svg" href="/w2025/assets/javascript.svg">
    <link rel="shortcut icon" type="image/svg" href="/w2025/assets/javascript.svg">
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/w2025/assets/css/0.styles.33415ee0.css" as="style"><link rel="preload" href="/w2025/assets/js/app.87c858a9.js" as="script"><link rel="preload" href="/w2025/assets/js/2.ccdb61a5.js" as="script"><link rel="preload" href="/w2025/assets/js/3.05989ff3.js" as="script"><link rel="preload" href="/w2025/assets/js/9.01890ce5.js" as="script"><link rel="preload" href="/w2025/assets/js/11.5fe5a40b.js" as="script"><link rel="prefetch" href="/w2025/assets/js/10.3e691a48.js"><link rel="prefetch" href="/w2025/assets/js/12.f49551e7.js"><link rel="prefetch" href="/w2025/assets/js/13.d5974a84.js"><link rel="prefetch" href="/w2025/assets/js/14.32f7e6e8.js"><link rel="prefetch" href="/w2025/assets/js/15.0ae027c8.js"><link rel="prefetch" href="/w2025/assets/js/16.f2386a1e.js"><link rel="prefetch" href="/w2025/assets/js/17.d7b9d534.js"><link rel="prefetch" href="/w2025/assets/js/18.7c15b945.js"><link rel="prefetch" href="/w2025/assets/js/19.51980183.js"><link rel="prefetch" href="/w2025/assets/js/20.d519c082.js"><link rel="prefetch" href="/w2025/assets/js/21.362f6b8c.js"><link rel="prefetch" href="/w2025/assets/js/22.afaf2123.js"><link rel="prefetch" href="/w2025/assets/js/23.cdc2c887.js"><link rel="prefetch" href="/w2025/assets/js/24.9b75b7c6.js"><link rel="prefetch" href="/w2025/assets/js/25.e357a328.js"><link rel="prefetch" href="/w2025/assets/js/26.6e814142.js"><link rel="prefetch" href="/w2025/assets/js/27.106c07bd.js"><link rel="prefetch" href="/w2025/assets/js/28.126c37bf.js"><link rel="prefetch" href="/w2025/assets/js/29.ca946c51.js"><link rel="prefetch" href="/w2025/assets/js/30.2ba498f6.js"><link rel="prefetch" href="/w2025/assets/js/31.e41d2241.js"><link rel="prefetch" href="/w2025/assets/js/32.cfce5625.js"><link rel="prefetch" href="/w2025/assets/js/33.3dc1268c.js"><link rel="prefetch" href="/w2025/assets/js/34.a3793153.js"><link rel="prefetch" href="/w2025/assets/js/35.ab1290f2.js"><link rel="prefetch" href="/w2025/assets/js/36.3d9064e0.js"><link rel="prefetch" href="/w2025/assets/js/37.2ae4164b.js"><link rel="prefetch" href="/w2025/assets/js/38.195bef2c.js"><link rel="prefetch" href="/w2025/assets/js/39.a9904a96.js"><link rel="prefetch" href="/w2025/assets/js/4.79533d7f.js"><link rel="prefetch" href="/w2025/assets/js/40.1c93503b.js"><link rel="prefetch" href="/w2025/assets/js/41.61991e2b.js"><link rel="prefetch" href="/w2025/assets/js/42.87d5cabf.js"><link rel="prefetch" href="/w2025/assets/js/43.d8a479ef.js"><link rel="prefetch" href="/w2025/assets/js/44.8446907e.js"><link rel="prefetch" href="/w2025/assets/js/45.d1e73d03.js"><link rel="prefetch" href="/w2025/assets/js/46.14dd0c4d.js"><link rel="prefetch" href="/w2025/assets/js/47.6eae941d.js"><link rel="prefetch" href="/w2025/assets/js/48.4b257292.js"><link rel="prefetch" href="/w2025/assets/js/49.7c622f43.js"><link rel="prefetch" href="/w2025/assets/js/5.60adfd1c.js"><link rel="prefetch" href="/w2025/assets/js/50.5cc4788b.js"><link rel="prefetch" href="/w2025/assets/js/51.345ce69e.js"><link rel="prefetch" href="/w2025/assets/js/52.59f792c0.js"><link rel="prefetch" href="/w2025/assets/js/53.9344eea4.js"><link rel="prefetch" href="/w2025/assets/js/6.96402398.js"><link rel="prefetch" href="/w2025/assets/js/7.956989e6.js"><link rel="prefetch" href="/w2025/assets/js/8.62f5a92b.js">
    <link rel="stylesheet" href="/w2025/assets/css/0.styles.33415ee0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/w2025/" class="home-link router-link-active"><img src="/w2025/mad-d-logo-sm.png" alt="MAD9022" class="logo"> <span class="site-name can-hide">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/w2025/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2025/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2025/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/w2025/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2025/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2025/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>PWA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/w2025/modules/pwas/week1/1.1/" class="sidebar-link">1.1: Course Intro &amp; Review</a></li><li><a href="/w2025/modules/pwas/week1/1.2/" class="sidebar-link">1.2: Review Topics</a></li><li><a href="/w2025/modules/pwas/week2/2.1/" class="sidebar-link">2.1: Single Page Applications</a></li><li><a href="/w2025/modules/pwas/week2/2.2/" aria-current="page" class="active sidebar-link">2.2: SPA &amp; Coding Practices</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week2/2.2/#error-handling" class="sidebar-link">Error Handling</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week2/2.2/#window-open" class="sidebar-link">window.open</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week2/2.2/#closures" class="sidebar-link">Closures</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week2/2.2/#passing-data-between-pages" class="sidebar-link">Passing Data between Pages</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week2/2.2/#single-source-of-truth" class="sidebar-link">Single Source of Truth</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week2/2.2/#serializable" class="sidebar-link">Serializable</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week2/2.2/#todo-this-week" class="sidebar-link">ToDo This Week</a></li></ul></li><li><a href="/w2025/modules/pwas/week3/3.1/" class="sidebar-link">3.1: Workers &amp; Service Workers</a></li><li><a href="/w2025/modules/pwas/week3/3.2/" class="sidebar-link">3.2: Service Worker Events</a></li><li><a href="/w2025/modules/pwas/week4/4.1/" class="sidebar-link">4.1: Messaging</a></li><li><a href="/w2025/modules/pwas/week4/4.2/" class="sidebar-link">4.2: Intro to PWAs</a></li><li><a href="/w2025/modules/pwas/week5/5.1/" class="sidebar-link">5.1: PWAs Continued</a></li><li><a href="/w2025/modules/pwas/week5/5.2/" class="sidebar-link">5.2: IndexedDB &amp; Data</a></li><li><a href="/w2025/modules/pwas/week6/6.1/" class="sidebar-link">6.1: Hosting Projects</a></li><li><a href="/w2025/modules/pwas/week6/6.2/" class="sidebar-link">6.2: PWA Project</a></li><li><a href="/w2025/modules/pwas/week7/7.1/" class="sidebar-link">7.1: Git Pull Requests</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title red">
    PWA
  </div> <h1>2.2 SPA &amp; Coding Practices</h1> <div class="underdev no">Module Still Under Development</div></header> <h2 id="error-handling"><a href="#error-handling" class="header-anchor">#</a> Error Handling</h2> <p>When we build web apps, we should always tell users when there is a problem. If some piece of functionality fails the user needs to know why. There are error messages that make sense to users and there are error messages that make sense to developers.</p> <p>Consider the following</p> <p><img src="/w2025/assets/img/error-1.9728840b.png" alt="Error 1 example"> <img src="/w2025/assets/img/error-2.0d67059b.png" alt="Error 2 example"> <img src="/w2025/assets/img/error-3.b8f573ab.png" alt="Error 3 example"> <img src="/w2025/assets/img/error-4.93c39ae3.png" alt="Error 4 example"> <img src="/w2025/assets/img/error-5.b2d902aa.png" alt="Error 5 example"> <img src="/w2025/assets/img/error-6.fe00b4e6.png" alt="Error 6 example"> <img src="/w2025/assets/img/error-7.a626d016.png" alt="Error 7 example"></p> <p>These are all error and warning messages from a variety of sites. If we are simply taking the text from these when we use <code>err.message</code> inside our catch methods, then we are not giving any useful information to our users.</p> <p>We should be using a <code>&lt;dialog&gt;</code> element to display the message, if it is something that we need the user to acknowledge. If we want the user to acknowledge the message, then we mean that we want them to have to click on something to make the message disappear.</p> <p>If the user just needs to be informed, but not acknowledge with a click, then we can just display the message inline on the page. Create a <code>&lt;div&gt;</code> and use a class name that will be defined in our CSS. There can be different types of messages which we can classify as <code>info</code>, <code>success</code>, <code>warning</code>, and <code>error</code>. These would be styled respectively as blue, green, amber, and red.</p> <p>The inline message can have an optional <code>setTimeout</code> call which will remove the message automatically after a predefined period of time, like 5 seconds. These messages can also have an optional close button.</p> <blockquote><p>So, we need to be sure that we have a user friendly error message.</p></blockquote> <p>The other recommended part of this, is coming up with custom error objects for all the different types of issues that your web app could have.</p> <ul><li>form not filled in properly</li> <li>user not authenticated</li> <li>fetch missing a header</li> <li>no data returned from an API call</li></ul> <p>All errors need to be handled with either <code>try{ }catch(err){ }</code> or <code>.then(()=&gt;{}).catch(err=&gt;{})</code>.</p> <p>So, we want to create a series of custom Error Objects. Each error type is able to hold custom properties that are relevant to the type of error. Fetch errors should contain a reference to the Response object. Form errors should contain a reference to the form or the input element that caused the issue.</p> <p>The class syntax makes it easy to create our error objects.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">FormError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">_message<span class="token punctuation">,</span> _element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>_message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'FormError'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>inputElement <span class="token operator">=</span> _element<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FetchError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">_message<span class="token punctuation">,</span> _response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>_message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'FetchError'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>response <span class="token operator">=</span> _response<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> _response<span class="token punctuation">.</span>status<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>_response<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> FormError<span class="token punctuation">,</span> FetchError <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Then we can put all of these error classes into a utility file that we import into our other main scripts, as needed.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> FormError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./utils.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleForm</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//form submitted</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> email <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>email<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">FormError</span><span class="token punctuation">(</span><span class="token string">'Missing required email address'</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>email<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">FormError</span><span class="token punctuation">(</span><span class="token string">'Email address exceeds max 80 characters'</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'FormError'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> input <span class="token operator">=</span> err<span class="token punctuation">.</span>inputElement<span class="token punctuation">;</span>
      input<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//put the cursor back in this element</span>
      input<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//for styling</span>
      <span class="token function">showErrorMessage</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//pass the error message to a common function for displaying the errors</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//generic error that is not FormError</span>
      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//for the developer</span>
      <span class="token comment">//generic/simpler error message for the user</span>
      <span class="token function">showErrorMessage</span><span class="token punctuation">(</span><span class="token string">'Sorry unable to process the form.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="window-open"><a href="#window-open" class="header-anchor">#</a> window.open</h2> <p>If you want to open a link in a new tab, this is a simple thing to do from your HTML. Just add the target attribute with a value of <code>_blank</code>. Whether the link is to a different page or even to a different id from the same page, with the target attribute set to <code>_blank</code>, the browser will open a new tab.</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>somepage.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_blank<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Open in a new tab<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#someid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_blank<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Open in a new tab<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>If you want to control whether you open a link in a new tab or a new window, then you need to use JavaScript.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> windowRef <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> target<span class="token punctuation">,</span> windowFeatures<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The <code>url</code> parameter is a string url. If an empty string is used, a blank page will be opened.</p> <p>The <code>target</code> parameter is the same as the target attribute in an anchor tag. We want to use <code>_blank</code>.</p> <p>The <code>windowFeatures</code> parameter is an object with settings for things like the size of the new window, which browser bars should be shown, and whether it is a new window or a new tab. The setting for a new window vs a new tab is <code>popup</code>. If set to <code>true</code> then a new window will be used. Many of the other settings are actually legacy settings. Many of which are ignored by the browser now due to abuse by developers in the past.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">openTab</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ref <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'_blank'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//ref is the window object in the new tab</span>
  <span class="token keyword">return</span> ref<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">openWindow</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ref <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_blank</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">popup</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//ref is the window object in the new window</span>
  <span class="token keyword">return</span> ref<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Both versions will return a reference to the window object in the newly opened tab or window. This can be useful when your script needs to interact with the new window later on. In the new window, it will have a value for the <code>window.opener</code> property. This will be <code>null</code> or a reference to the <code>window</code> object that opened the new window/tab.</p> <p>Want to write a console.log message in the console of the new window?</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>ref<span class="token punctuation">.</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ref<span class="token punctuation">.</span>opener<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//window.opener is a reference to the window object that opened the window.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>As long as the two windows come from the same origin, they can access and use each other's window object... and therefore all the functionality and features of each other's windows.</p> <h2 id="closures"><a href="#closures" class="header-anchor">#</a> Closures</h2> <p>Closures are a feature of JavaScript, and some other programming languages, where a protective bubble can be created around one or more variables so they can continue to be referenced after their containing function has finished running.</p> <p>Closures are one of the rare times where you will see a function being declared inside another function.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//`type` and `say` are both local to the function greeting</span>
  <span class="token comment">//the code inside of say will be able to access the variable `type`</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$type $name</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//each time we call greeting we are creating a closure around `type`</span>
<span class="token comment">// and return a reference to `say()`.</span>
<span class="token keyword">const</span> hello <span class="token operator">=</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> hola <span class="token operator">=</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token string">'Hola'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> hallo <span class="token operator">=</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token string">'Hallo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//we now have 3 new functions that we can call</span>
<span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">'Sam'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello Sam</span>
<span class="token function">hola</span><span class="token punctuation">(</span><span class="token string">'Dean'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hola Dean</span>
<span class="token function">hallo</span><span class="token punctuation">(</span><span class="token string">'Rowena'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hallo Rowena</span>
<span class="token function">hola</span><span class="token punctuation">(</span><span class="token string">'Charlie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hola Charlie</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>The <code>greeting</code> function is like a function for creating functions that include a closure. This process of creating a new function that has a closure is called <strong>Currying</strong> after the mathematician, computer scientist - Haskell Curry. The <code>Haskell</code> programming language is also named after him.</p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" target="_blank" rel="noopener noreferrer">MDN closure reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="passing-data-between-pages"><a href="#passing-data-between-pages" class="header-anchor">#</a> Passing Data between Pages</h2> <p>When building a multi-page website there will often be times when you want to pass data, as key-value pairs, between your pages.</p> <p>Each HTML page will load, and then load the script for the page. So, we need to be able to package the data in a way that can then be sent from the first page along with the HTTP Request and then read
from the HTTP Response. The approaches from easiest to hardest are:</p> <ol><li>In the URL querystring.</li> <li>In a cookie.</li> <li>Written with some type of storage API that can be read on the second page (localStorage, sessionStorage, IndexedDB, and CacheAPI).</li></ol> <h3 id="in-the-querystring"><a href="#in-the-querystring" class="header-anchor">#</a> In the QueryString</h3> <p>To pass data through the querystring, you can hard code a value in an anchor tag.</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/pagetwo.html?name=sam&amp;brother=dean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Go to Page Two<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Then in the script on the second page you can extract the value from the querystring.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//the current page url</span>
<span class="token keyword">let</span> params <span class="token operator">=</span> url<span class="token punctuation">.</span>searchParams<span class="token punctuation">;</span> <span class="token comment">// a URLSearchParams object with all the queryString parameters</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sam</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'brother'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// dean</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr> <p>In the first page, if you want to dynamically add elements to a querystring in a URL, you can use a similar script to the second page.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'http://localhost:/pagetwo.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// or url.searchParams</span>
params<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'sam'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'brother'</span><span class="token punctuation">,</span> <span class="token string">'dean'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
url<span class="token punctuation">.</span>search <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
location<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//navigate to the new page with the querystring</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Another way this can be accomplished is by submitting a form. An HTML <code>&lt;form&gt;</code> element has a <code>method</code> attribute with a default value of <code>GET</code>, and an <code>action</code> attribute which is the URL to use as the
HTTP Request URL. When a form is submitted an HTTP GET Request is sent to the server for the URL defined in the action. The elements from the form (input, select, textarea, button) will have their
name and value pairs added to the querystring if the method is the default <code>GET</code>.</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pagetwo.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>GET<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sam<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>brother<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dean<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>send<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>SEND DATA TO PAGE TWO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>NOTE: the form elements must have <code>name</code> attributes, not just <code>id</code>s.</p></blockquote> <p>When the user clicks the button, the form is submitted. This means an HTTP request is made for the url in the action attribute using the method defined in the method attribute.</p> <h3 id="in-a-cookie"><a href="#in-a-cookie" class="header-anchor">#</a> In a Cookie</h3> <p>A cookie is really just a header in an HTTP Request or Response.</p> <p>An HTTP <strong>Request</strong> can have a header called <code>cookie</code>, whose value will be the cookies currently saved in the browser.</p> <p>An HTTP <strong>Response</strong> can have a header called <code>set-cookie</code>, whose value will be a cookie that needs to be saved by the browser.</p> <p>If you use JavaScript to set a cookie in the browser:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'name=sam;maxAge=3600;httpOnly;secure;path=/'</span><span class="token punctuation">;</span>
<span class="token comment">//cookie can only be read by the browser, not JS</span>
<span class="token comment">//only passed over HTTPS</span>
<span class="token comment">//valid anywhere on the site starting with the path /</span>
<span class="token comment">//valid for one hour (60 seconds * 60)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>then it will be part of the next HTTP Request made to the server. The next page to load will be able to access the <code>document.cookie</code> value too.</p> <p>Cookies that have the <code>httpOnly=true</code> flag setting will not be cookies that can be set, read, or modified in JavaScript. They will automatically be sent with every navigation request and response, but
not with fetch calls. They can only be set in a Response object that is coming from the server.</p> <h3 id="storage-apis"><a href="#storage-apis" class="header-anchor">#</a> Storage APIs</h3> <p>With localStorage and sessionStorage you use a key to label the data and then you can store any value that can be stringified with the <code>JSON.stringify()</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//on page one</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'sam'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">brother</span><span class="token operator">:</span> <span class="token string">'dean'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'mydata'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//on page two</span>
<span class="token keyword">let</span> json <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'mydata'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> json <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>With <code>IndexedDB</code> you can also save information to be read later on from another page. The premise is the same as working with localStorage or sessionStorage, it just requires more code.</p> <p>With the Cache API you can also save data to be read later. However, you need to turn the data into a file to be opened and read later.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//on page one</span>
<span class="token keyword">let</span> dataTxt <span class="token operator">=</span> <span class="token string">'name=sam&amp;brother=dean'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> textFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>dataTxt<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'data.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/plain'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> dataObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'sam'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">brother</span><span class="token operator">:</span> <span class="token string">'dean'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>dataObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> jsonFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>json<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'data.json'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> cache <span class="token operator">=</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'myfiles'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> textRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'data.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>textRequest<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>textFile<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'text/plain'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> jsonRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'data.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>jsonRequest<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>jsonFile<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>The above code will create a text file and a json file and save them in the cache for the current origin.</p> <p>To retrieve the data we use the <code>cache.match()</code> method to extract the Response objects from the cache. Then you can do exactly what you would do with a fetch response. Call the <code>.json()</code> or <code>.text()</code>
method to read the contents from the files.</p> <p>If you want to review the notes about the Storage event you can <a href="https://mad9014.github.io/f2024/modules/browser-js/week12/storage/#web-storage-api" target="_blank" rel="noopener noreferrer">read the full notes from the mad9014 site<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. It explains how tabs can notify each other if the contents of sessionStorage or localStorage were changed inside the current active tab.</p> <h2 id="single-source-of-truth"><a href="#single-source-of-truth" class="header-anchor">#</a> Single Source of Truth</h2> <p>When working with data sources like localStorage and cookies, which are not directly accessible as a variable, we need to create what is known as a <code>single source of truth</code>.</p> <p>It is possible to have multiple functions in multiple scripts that are accessing the values in your cookies or localStorage within the context of the same page load. If one script updates
<code>localStorage</code> then we might not know that the change was made in another function that is sharing that data.</p> <p>To avoid problems caused by this the best approach is to create your own <strong>globally accessible</strong> variable that will hold the data.</p> <p>The <code>cookie</code> and <code>localStorage</code> values are the <strong>CACHED</strong> copy of the data. They only exist to give us context when the app is loaded the next time. We do NOT work directly from these sources. We do
not keep updating and re-reading these data sources. Only read the value once when the page loads. Work with a local copy of the data from a variable. Update your variable as needed. Overwrite the
cookie or localStorage after you update your variable.</p> <p>When the page first loads, we read the value from the <code>cookie</code> and/or <code>localStorage</code> and put it into the global variable.</p> <p>Any function that needs to access or change the information will make the change to that global variable.</p> <p>Each time the global variable is altered you can call on the <code>document.cookie</code> property or <code>localStorage.setItem</code> method to update the <code>cached</code> value. Remember we are only updating the cache for the
next time the app loads.</p> <p>The only time we ever read from the storage is when the app first loads - using the <code>DOMContentLoaded</code> event as our trigger to fetch the cached data.</p> <h2 id="serializable"><a href="#serializable" class="header-anchor">#</a> Serializable</h2> <p>In JavaScript, functions are first class objects. That means you can store a reference to a function inside a variable, and you can pass a function reference as a parameter to a function or as a return value from a function.</p> <p><strong>However</strong>, you cannot store a function inside of a JSON string. There is no way to send a function to a server via an HTTP Request or from a server via an HTTP Response.</p> <p>Functions are not <code>serializable</code>. This means that they cannot be converted into a JSON representation. HTML Elements are another type of Object that is also not <code>serializable</code>.</p> <p>As a side note, there is a way to save the functionality from a function as a string to be used later or passed around. The contents of the function could be a String. The String can be passed to the <code>Function</code> constructor to create a function that can be run later.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">let num=2; console.log(num * 4)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">let</span> f1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//calling f1 will run the code</span>
<span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The String can be put into localStorage or the Cache API or uploaded to the server. However, the function <code>f1</code> cannot be serialized for placement in a JSON string or passed as a message between contexts.</p> <h3 id="structuredclone"><a href="#structuredclone" class="header-anchor">#</a> StructuredClone</h3> <p>If you want to make a copy of a JavaScript object and avoid having to recursively copy the nested objects, then you can use the new <code>structuredClone()</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">prop1</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">prop2</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">234</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">456</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> copy <span class="token operator">=</span> <span class="token function">structuredClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//make a copy of the nested array and object inside the new copy object</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div title="Intro to JS StructuredClone" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/M3JO4qxTLH0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h3 id="passing-functions"><a href="#passing-functions" class="header-anchor">#</a> Passing Functions</h3> <p>So, if you can't pass a function through an HTTP Request or Response it also means that you can't pass a function as a <code>message</code> between a page and a service worker or between tabs. Later on we will
be talking about Client API messaging, Broadcast messaging, and Channel messaging. We will need a solution to passing a function.</p> <p>What we <strong>can</strong> pass is a <code>String</code>. We can pass the name of a function as a String.</p> <p>When you declare a function, in a <strong>non-module script</strong>, the name of the function is actually added to the window object. You can check if the property is there.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sam</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this is sam.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">dean</span><span class="token punctuation">(</span><span class="token parameter">nameOfFunc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>nameOfFunc <span class="token keyword">in</span> window <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> window<span class="token punctuation">[</span>nameOfFunc<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//property exists in the window object</span>
    <span class="token comment">//and the property is a function</span>
    <span class="token comment">//so you can call the function</span>
    <span class="token function">nameOfFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">function </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>nameOfFunc<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> does not exist.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'sam'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//this is sam</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'crowley'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//function crowley does not exist</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'rowena'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//function rowena does not exist</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>The above solution works if you are not dealing with a module. When you load a script with <code>&lt;script type=&quot;module&quot;&gt;</code> it means that a module scope is created for the file and the functions are NOT added
to the <code>window</code> object. If this is the case, then you can take the name of the function and wrap it in an <code>eval()</code> call. This will try to convert the string into an object with a matching name - the
function.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//script loaded as module</span>
<span class="token keyword">function</span> <span class="token function">sam</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This is sam.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">dean</span><span class="token punctuation">(</span><span class="token parameter">nameOfFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token function">eval</span><span class="token punctuation">(</span>nameOfFunction<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//it is a function so call it</span>
    <span class="token function">eval</span><span class="token punctuation">(</span>nameOfFunction<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>nameOfFuntion<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not a function.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'sam'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// This is sam.</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'charlie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// charlie is not a function.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>One other way that this can be accomplished with modules is if you place all the functions that you want to call, based on their names, into their own module and you import that file with a namespace.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// list.js</span>
<span class="token comment">//my functions to call based on name</span>
<span class="token keyword">function</span> <span class="token function">sam</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This is sam.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">crowley</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This is crowley.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> sam<span class="token punctuation">,</span> crowley <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Above is the file that we will import and search for function names.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">LIST</span> <span class="token keyword">from</span> <span class="token string">'./list.js'</span><span class="token punctuation">;</span>
<span class="token comment">//LIST is the module object from './list.js'</span>

<span class="token keyword">function</span> <span class="token function">dean</span><span class="token punctuation">(</span><span class="token parameter">nameOfFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>nameOfFunction <span class="token keyword">in</span> <span class="token constant">LIST</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> <span class="token constant">LIST</span><span class="token punctuation">[</span>nameOfFunction<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//it is something imported in LIST</span>
    <span class="token comment">//it is a function</span>
    <span class="token comment">//call the function</span>
    <span class="token constant">LIST</span><span class="token punctuation">[</span>nameOfFunction<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Not a function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'sam'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// works</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'crowley'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// works</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'rowena'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// fails</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="todo-this-week"><a href="#todo-this-week" class="header-anchor">#</a> ToDo This Week</h2> <div class="custom-block danger"><p class="custom-block-title">To Do this week</p> <ul><li>read all the content for modules 2.1 and 2.2</li> <li>Complete and submit <a href="/w2025/modules/hybrids/exercises.html">Hybrid exercise 1 - JS Class Quiz</a>.</li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/11/2025, 5:10:50 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/w2025/modules/pwas/week2/2.1/" class="prev">
        2.1: Single Page Applications
      </a></span> <span class="next"><a href="/w2025/modules/pwas/week3/3.1/">
        3.1: Workers &amp; Service Workers
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/w2025/assets/js/app.87c858a9.js" defer></script><script src="/w2025/assets/js/2.ccdb61a5.js" defer></script><script src="/w2025/assets/js/3.05989ff3.js" defer></script><script src="/w2025/assets/js/9.01890ce5.js" defer></script><script src="/w2025/assets/js/11.5fe5a40b.js" defer></script>
  </body>
</html>
