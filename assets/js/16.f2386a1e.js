(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{280:function(e,t,a){e.exports=a.p+"assets/img/lifecycle.1d49eede.png"},333:function(e,t,a){"use strict";a.r(t);var s=a(10),n=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("PageHeader"),e._v(" "),t("h2",{attrs:{id:"workers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#workers"}},[e._v("#")]),e._v(" Workers")]),e._v(" "),t("p",[e._v("Workers are a special kind of JavaScript file that uses a new thread for processing the script.")]),e._v(" "),t("p",[e._v("If you have a webpage with three "),t("code",[e._v("<script>")]),e._v(" tags, then all three of those scripts are loaded into the same thread which is created for the current domain.")]),e._v(" "),t("p",[e._v("If you create a worker script then it will create a second thread for the domain and run there. It can be a useful way to offload some processor intensive tasks.")]),e._v(" "),t("p",[e._v("There are three kinds of shared workers. They are called shared because they can be accessed by all other scripts that are running in the browser across all windows and tabs that are loading pages\nfrom the same domain.")]),e._v(" "),t("p",[e._v("The first type is a "),t("code",[e._v("Worklet")]),e._v(". These are specifically for tasks related to Audio processing, CSS and rendering of the UI. We won't be using any Worklets in our courses.\n"),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Worklet",target:"_blank",rel:"noopener noreferrer"}},[e._v("Here is a reference for Worklets"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("The second kind is called a "),t("code",[e._v("Web Worker")]),e._v(". These are very general workers meant for any processing task that you want. The Worker gets launched by the web page's current script and only run while the page is active. They cannot access the DOM for the current page. However, they are capable of passing messages back and forth between the worker and the page.")]),e._v(" "),t("p",[e._v("The third kind is called a "),t("code",[e._v("Service Worker")]),e._v(". The service workers are more useful and are key to building Progressive Web Applications (PWA). These are shared scripts that are installed by the current webpage and they stay installed for future visits. They work like proxy servers and intercept every HTTP Request that comes from the web page and every HTTP Response that comes from the web server. They can access the Cache API, LocalStorage, IndexedDB, and Cookies for the current domain. They cannot access the DOM for the current webpage. They are capable of passing messages back and forth\nbetween the worker and the page.")]),e._v(" "),t("p",[e._v("Here is a "),t("a",{attrs:{href:"https://bitsofco.de/web-workers-vs-service-workers-vs-worklets/",target:"_blank",rel:"noopener noreferrer"}},[e._v("great article"),t("OutboundLink")],1),e._v(" about the differences between Service Workers, Web Workers, and Worklets. All three are "),t("code",[e._v("workers")]),e._v(" meaning that they get launched from a webpage script and they run on a separate thread to offload some processor intensive work.")]),e._v(" "),t("h2",{attrs:{id:"web-workers-and-shared-web-workers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#web-workers-and-shared-web-workers"}},[e._v("#")]),e._v(" Web Workers and Shared Web Workers")]),e._v(" "),t("p",[e._v("By now we are very familiar with the idea that JavaScript runs the main stack on a single thread. This means that the main stack runs in a synchronous way - one task at a time.")]),e._v(" "),t("p",[e._v("We do have asynchronous things like Events, Timers, and Promises which will be placed on another thread to be handled. When they are ready to be used they get put in a queue to wait to be added back onto the main stack. They can only be added back onto the main stack when it is empty and all the current tasks are complete.")]),e._v(" "),t("p",[e._v("So, if you have a processor intensive task to complete but it isn't connected to a Promise, Timer, or Event then you are stuck with the main stack not able to do anything until it finishes this big task. Updating the interface and interacting with the user in a real-time way could be jeopardized.")]),e._v(" "),t("p",[e._v("The solution? Web Workers. With these, we can actually create our own new thread to use and run our complex task on that other thread. Our main stack will, once again, be free to work with the interface and the user. Web Workers can contain practically any code we want, except it is not allow to access the DOM (the interface).")]),e._v(" "),t("p",[e._v("There are actually two kinds of Web Workers. The standard Web Worker and a Shared Web Worker.")]),e._v(" "),t("p",[t("strong",[e._v("Shared Web Workers")]),e._v(" are workers that can be utilized by multiple scripts running in different windows, IFrames, etc., as long as they are in the same domain as the worker. They are a little more complex than dedicated workers â€” scripts must communicate via an active port. You can learn about communicating over ports in the week 4 module on Channel Messaging.")]),e._v(" "),t("YouTube",{attrs:{title:"Shared Web Workers",url:"https://www.youtube.com/embed/EiPytIxrZtU"}}),e._v(" "),t("h3",{attrs:{id:"worklets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#worklets"}},[e._v("#")]),e._v(" Worklets")]),e._v(" "),t("p",[e._v("There are also "),t("code",[e._v("Worklets")]),e._v(" which are lightweight versions of Workers that can give developers access to low-level parts of the rendering pipeline.")]),e._v(" "),t("p",[e._v("You can learn more about "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Worklet",target:"_blank",rel:"noopener noreferrer"}},[e._v("Worklets on MDN"),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"registering-and-installing-service-workers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#registering-and-installing-service-workers"}},[e._v("#")]),e._v(" Registering and Installing Service Workers")]),e._v(" "),t("p",[e._v("The last kind of worker is a Service Worker. These are external javascript files that are designed to run in the background behind all the pages for your origin. They are not allowed to touch the DOM but they can work with "),t("code",[e._v("fetch()")]),e._v(", the Cache API, and IndexedDB. This makes them perfect to use as a Proxy Server that manages the contents of your web site and that is responsible for storing data and backups.")]),e._v(" "),t("p",[e._v("They are also one of the requirements for building a Progressive Web App (our eventual goal).")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API",target:"_blank",rel:"noopener noreferrer"}},[e._v("MDN Reference for the Service Worker API"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("Service Workers are Event driven, meaning that events are the trigger for any of its code to run. Everything that you do in a Service Worker is also asynchronous, they make heavy use of Promises. So, synchronous APIs like XHR and WebStorage and DOM are not accessible.")]),e._v(" "),t("p",[e._v("Beyond the domain "),t("code",[e._v("localhost")]),e._v(" || "),t("code",[e._v("127.0.0.1")]),e._v(", "),t("strong",[e._v("https")]),e._v(" must be used with Service Workers.")]),e._v(" "),t("p",[e._v("In most browsers, Service Workers, like the Cache API, will not run in Private Browser Mode / Incognito Mode.")]),e._v(" "),t("p",[e._v("Registering a service worker for your website can be quite simple.")]),e._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'serviceWorker'")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" navigator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//means the browser supports service workers")]),e._v("\n  navigator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("serviceWorker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/service-worker.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("p",[e._v("The "),t("code",[e._v("serviceWorker")]),e._v(" object exists inside the "),t("code",[e._v("window.navigator")]),e._v(" object. You can call the file that holds your service worker anything that you want but it should be saved at the root of your website.")]),e._v(" "),t("p",[e._v("When you register the file it will automatically be applied to EVERY tab and EVERY webpage under the current domain.")]),e._v(" "),t("p",[e._v("If you are working on a project that is running in Chrome under "),t("code",[e._v("http://127.0.0.1:5500")]),e._v(" and you register a Service Worker then it will remain there and apply to every webpage from "),t("code",[e._v("http://127.0.0.1/")]),e._v("\nthat you open on Chrome until you remove it yourself through the Chrome Dev tools.")]),e._v(" "),t("p",[e._v("If you want to see if a Service Worker is currently running for your webpage, you can use this:")]),e._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'serviceWorker'")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" navigator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Do a check to see if a service worker is in control.")]),e._v("\n  navigator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("serviceWorker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("ready"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("registration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token template-string"}},[t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("A service worker is active: ")]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("${")]),e._v("registration"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("active"),t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("}")])]),t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// At this point, you can call methods that require an active")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// service worker, like registration.pushManager.subscribe()")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// or registration.active.postMessage(messageObj);")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("else")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Service workers are not supported.'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br")])]),t("p",[e._v("In some other code samples and in the videos you will see the "),t("code",[e._v("navigator.serviceWorker.controller")]),e._v(" as well as the "),t("code",[e._v("controllerchange")]),e._v(" event being used when we want to interact with a ServiceWorker. I would not recommend that you use this now. Using "),t("code",[e._v("navigator.serviceWorker.ready")]),e._v(" gives you a Promise that resolves to a service worker registration object. This means it waits until the Service Worker is confirmed to be installed and activated for the current origin.")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("Best Practice")]),e._v(" "),t("p",[e._v("The Promise-based "),t("code",[e._v("navigator.serviceWorker.ready")]),e._v(" is a better way to have your code wait for access to a controller, rather than listening for the "),t("code",[e._v("controllerchange")]),e._v(" event.")])]),e._v(" "),t("h3",{attrs:{id:"life-cycle-for-service-workers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#life-cycle-for-service-workers"}},[e._v("#")]),e._v(" Life-cycle for Service Workers")]),e._v(" "),t("p",[e._v("The life cycle for service workers has two critical events "),t("code",[e._v("install")]),e._v(" and "),t("code",[e._v("activate")]),e._v(". When you call the "),t("code",[e._v("register")]),e._v(" method for the service worker from your main script, the browser will check to see if this specific file has previously been installed for the current origin. If not, then it will install it and trigger the "),t("code",[e._v("install")]),e._v(" event.")]),e._v(" "),t("p",[e._v("If the file was previously installed but there is a change to the code inside the file then it will trigger a new installation of the script. Service workers are installed for a specific domain. Service Workers are tied to the current domain.")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("activate")]),e._v(" event happens when a service worker has been installed and there is no other service worker currently running on any tab in the browser for the current domain. As long as there is still an older service worker running, the browser will not want to active the new file or new version.")]),e._v(" "),t("p",[e._v("If you load your webpage once and the browser "),t("code",[e._v("install")]),e._v("s and "),t("code",[e._v("activate")]),e._v("s a service worker, then you edit the service worker and reload your webpage, the browser will "),t("code",[e._v("install")]),e._v(" but "),t("strong",[e._v("NOT")]),e._v(" "),t("code",[e._v("activate")]),e._v(" the new version because the older one is still active and running. Refreshing a second time will unload the old one and "),t("code",[e._v("activate")]),e._v(" the newest version that is installed.")]),e._v(" "),t("p",[e._v("Once activated the service worker can handle events for "),t("code",[e._v("fetch")]),e._v(" and messaging between the worker and the webpage.")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("install")]),e._v(" event is the best time to create any new version of the file cache array that you will need for your new service worker.")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("activate")]),e._v(" event is when you would delete old versions of the file cache.")]),e._v(" "),t("p",[e._v("If you want to update your IndexedDB then you can open the new version of the database from inside your "),t("code",[e._v("activate")]),e._v(" event listener function and use the IndexedDB "),t("code",[e._v("upgradeneeded")]),e._v(" event to make any structural changes you want to the local database.")]),e._v(" "),t("p",[e._v("Inside your Service Worker file you can add listeners for the "),t("code",[e._v("install")]),e._v(" and "),t("code",[e._v("activate")]),e._v(" events. The keyword "),t("code",[e._v("self")]),e._v(" is used in the service worker script to refer to itself. "),t("code",[e._v("self")]),e._v(" is the service worker equivalent of the "),t("code",[e._v("window")]),e._v(" object.")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("SELF")]),e._v(" "),t("p",[e._v("In your normal non-worker browser scripts the global object that holds everything is "),t("code",[e._v("window")]),e._v(". In a Service Worker, it is a different execution context, and we use the keyword "),t("code",[e._v("self")]),e._v(" as the global object.")])]),e._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[e._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("addEventListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'install'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("ev")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//code to run when the install event happens")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\nself"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("addEventListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'activate'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("ev")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//code to run when the service worker becomes active")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("p",[e._v("Since, the manner in which cached files, database access, and fetch calls are handled, can be very sensitive to the specific version of the client side script in the browser we have to be able to\nmanage the installing and activating of these shared service workers.")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("installing -> installed -> waiting -> activating -> activated -> idle -> stopped -> terminated\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("The "),t("code",[e._v("idle")]),e._v(" phase happens when the webpage is still active but the service worker has nothing to do.")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("stopped")]),e._v(" phase happens when the tabs for the current domain are all closed. The service worker is still registered and installed but it is dormant. Once another page for that domain is loaded,\nthe Service Worker can become activated again.")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("terminated")]),e._v(" phase happens when a service worker is unregistered | uninstalled. This must happen before a new service worker for the domain gets activated.")]),e._v(" "),t("p",[t("img",{attrs:{src:a(280),alt:"lifecycle image"}})]),e._v(" "),t("p",[t("a",{attrs:{href:"https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle",target:"_blank",rel:"noopener noreferrer"}},[e._v("More reading on the lifeCycle"),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"install-and-activate-events"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-and-activate-events"}},[e._v("#")]),e._v(" Install and Activate Events")]),e._v(" "),t("p",[t("strong",[e._v("install event")]),e._v(" - This is the time to add an array of files to the cache that will be needed if offline and as part of various caching strategies.")]),e._v(" "),t("p",[t("strong",[e._v("activate event")]),e._v(" - This is the time to delete older versions of the cache that are no longer needed.")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("install")]),e._v(" and "),t("code",[e._v("activate")]),e._v(" events will use the "),t("code",[e._v("ev.waitUntil()")]),e._v(" method to wait for the Promise to be resolved, similar to the "),t("code",[e._v("await")]),e._v(" keyword. This way we are able to finish working with the Cache before the function stops running.")]),e._v(" "),t("p",[e._v("In the "),t("code",[e._v("fetch")]),e._v(" event we will use the "),t("code",[e._v("ev.respondWith()")]),e._v(" method to handle asynchronous fetch calls and send a response back to the browser.")]),e._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// sw.js - our service worker script")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("let")]),e._v(" cacheName "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'aUniqueCacheName'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("let")]),e._v(" cacheList "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//an array of files to save in the cache")]),e._v("\n\nself"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("addEventListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'install'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("ev")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//save the list of files in the cache")]),e._v("\n  ev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("waitUntil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n    caches"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("open")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("cacheName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("cache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      cache\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("addAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("cacheList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//all the files were saved in the cache")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("catch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("err")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//at least one file failed to be written to the cache")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br"),t("span",{staticClass:"line-number"},[e._v("16")]),t("br"),t("span",{staticClass:"line-number"},[e._v("17")]),t("br"),t("span",{staticClass:"line-number"},[e._v("18")]),t("br"),t("span",{staticClass:"line-number"},[e._v("19")]),t("br")])]),t("p",[e._v("Each of the entries in the Cache can be either a URL or a Response object.")]),e._v(" "),t("p",[e._v("In the "),t("code",[e._v("activate")]),e._v(" event we need to get a list of all the names of all the caches. We do this with the "),t("code",[e._v("keys()")]),e._v(" event which returns a Promise that contains an array of all the cache names.")]),e._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[e._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("addEventListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'activate'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("ev")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  ev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("waitUntil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n    caches"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("keys")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("keys")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" Promise"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("keys"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("filter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("nm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" nm "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" cacheName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("map")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("nm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" caches"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("delete")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("nm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("p",[e._v("The "),t("code",[e._v("ev.waitUntil")]),e._v(" method is important because of how the browser handles running workers in a separate thread. To try and keep things as efficient as possible, the browser always aims to shut down the Service Worker thread as quickly as possible.")]),e._v(" "),t("p",[e._v("If you are inside an event listener function for the "),t("code",[e._v("install")]),e._v(", "),t("code",[e._v("activate")]),e._v(", "),t("code",[e._v("fetch")]),e._v(", or "),t("code",[e._v("message")]),e._v(" events, then you might be trying to run a series of asynchronous tasks, like fetch(), cache.addAll() or Promise.all(). We don't know how long these things will take. It could be a minute. The browser starts wanting to shut down the worker thread after a second or two.")]),e._v(" "),t("p",[e._v("So, we pass our method call with "),t("code",[e._v("ev.waitUntil()")]),e._v(". We can only pass one Promise to the waitUntil method. However, it could be a call to "),t("code",[e._v("Promise.all()")]),e._v(" or a chain of Promise calls with "),t("code",[e._v(".then()")]),e._v(". Effectively, we can pass one thing that can be treated like a single expression to "),t("code",[e._v("waitUntil()")]),e._v(".")]),e._v(" "),t("h3",{attrs:{id:"dev-tools-for-service-workers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dev-tools-for-service-workers"}},[e._v("#")]),e._v(" Dev Tools for Service Workers")]),e._v(" "),t("p",[e._v("In Chrome, we can use the "),t("code",[e._v("Application")]),e._v(" tab in the Dev Tools to find everything we need to work with Service Workers. Service Worker Registration, IndexedDB, localStorage, Cookies, Caches, Manifest, and Background Services are all found in this tab.")]),e._v(" "),t("p",[e._v("If you select the "),t("code",[e._v("Service Workers")]),e._v(" item on the left side of the "),t("code",[e._v("Application")]),e._v(" tab, then you can control the behaviour of the current Service Worker for the current origin. The tab will display the current status of any Service Workers that have been installed for the origin. It will show you the "),t("strong",[e._v("active")]),e._v(" Service Worker plus all the "),t("strong",[e._v("installed")]),e._v(" ones. You can skipWaiting on the "),t("strong",[e._v("installed")]),e._v(" ones to have them replace the "),t("strong",[e._v("active")]),e._v(" one on the next refresh.")]),e._v(" "),t("p",[e._v("There are three checkboxes at the top of the tab:")]),e._v(" "),t("ul",[t("li",[e._v("Offline")]),e._v(" "),t("li",[e._v("Update on Reload")]),e._v(" "),t("li",[e._v("Bypass for Network")])]),e._v(" "),t("p",[e._v("The Offline checkbox has the same effect as the Throttling dropdown menu on the Network tab. It lets you ask the browser to pretend to be offline (no internet connection).")]),e._v(" "),t("p",[e._v("The Update on Reload checkbox will tell the browser to refresh the install of the Service Worker every time you refresh the web page. This can be useful if you are making frequent changes to the Service Worker.")]),e._v(" "),t("p",[e._v("The Bypass for Network checkbox is to tell the Service Worker to skip handling any fetch requests from the webpage and let them all go directly to the Server and back to the web page.")]),e._v(" "),t("p",[e._v("The other important feature on this tab is the link on the top-right which lets you unregister and remove a Service Worker from an origin.")]),e._v(" "),t("p",[e._v("Service Workers try to remain installed and control any pages for the same domain. This means that if you are doing development work over "),t("code",[e._v("127.0.0.1:5500")]),e._v(" from VSCode for different sites, you might get unexpected results if an old Service Worker is still install and registered for that domain, when you test your new site.")]),e._v(" "),t("p",[e._v("Another dev tool resource that you can use (in Chrome) with Service workers is the url "),t("a",{attrs:{href:"chrome://serviceworker-internals",target:"_blank"}},[e._v("chrome://serviceworker-internals")]),e._v(" which will list "),t("strong",[e._v("ALL")]),e._v(" the currently installed Service Workers in your browser and let you manage them.")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://www.youtube.com/playlist?list=PLyuRouwmQCjm3dOz4ea90ZqMRaicX07fo",target:"_blank",rel:"noopener noreferrer"}},[e._v("Here is a playlist about Chrome Dev tools"),t("OutboundLink")],1),e._v(" which includes many tools that are useful for Service Workers and Progressive Web Apps.")]),e._v(" "),t("p",[e._v("The videos in the playlist are:")]),e._v(" "),t("ol",[t("li",[e._v("Getting Started with Chrome Dev Tools")]),e._v(" "),t("li",[e._v("Testing Mobile and Responsive Designs")]),e._v(" "),t("li",[e._v("Chrome Dev Tools Debugging CSS")]),e._v(" "),t("li",[e._v("Chrome Dev Tools Network Traffic")]),e._v(" "),t("li",[e._v("Chrome Dev Tools Console Super-Powers")]),e._v(" "),t("li",[e._v("Chrome Dev Tools Source Panel and Breakpoints")]),e._v(" "),t("li",[e._v("Chrome Dev Tools Data and File Storage")])]),e._v(" "),t("h3",{attrs:{id:"service-worker-playlist"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#service-worker-playlist"}},[e._v("#")]),e._v(" Service Worker Playlist")]),e._v(" "),t("p",[e._v("Here is a whole playlist tutorial on how to build and use Service Workers.")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://www.youtube.com/watch?v=NJRu3pmmN-4&list=PLyuRouwmQCjl4iJgjH3i61tkqauM-NTGj",target:"_blank",rel:"noopener noreferrer"}},[e._v("Service Worker Playlist"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("The videos in the playlist are:")]),e._v(" "),t("ol",[t("li",[e._v("Registration, Life-Cycle, Events, and Dev Tools")]),e._v(" "),t("li",[e._v("The Cache API")]),e._v(" "),t("li",[e._v("waitUntil, skipWaiting, claim")]),e._v(" "),t("li",[e._v("How to integrate Caches")]),e._v(" "),t("li",[e._v("The Storage API")]),e._v(" "),t("li",[e._v("Controlling Fetch Calls")]),e._v(" "),t("li",[e._v("When Fetch Goes Wrong")]),e._v(" "),t("li",[e._v("Messaging Between Tabs and Service Workers")]),e._v(" "),t("li",[e._v("Integrating a Database")]),e._v(" "),t("li",[e._v("Building a Custom Response Object")]),e._v(" "),t("li",[e._v("File Handling for Web Apps")]),e._v(" "),t("li",[e._v("Clients API and Window Messaging")])]),e._v(" "),t("h2",{attrs:{id:"todo-this-week"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#todo-this-week"}},[e._v("#")]),e._v(" ToDo This Week")]),e._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[e._v("To Do this week")]),e._v(" "),t("ul",[t("li",[e._v("read all the content for modules 3.1 and 3.2")]),e._v(" "),t("li",[e._v("read all the content for Hybrid "),t("RouterLink",{attrs:{to:"/modules/hybrids/"}},[e._v("web component creation")])],1),e._v(" "),t("li",[e._v("start working on the "),t("RouterLink",{attrs:{to:"/modules/hybrids/exercises.html"}},[e._v("Hybrid web component Exercise")])],1)])])],1)}),[],!1,null,null,null);t.default=n.exports}}]);