<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>5.1 Building PWAs | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" type="image/svg" href="/w2025/assets/javascript.svg">
    <link rel="shortcut icon" type="image/svg" href="/w2025/assets/javascript.svg">
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/w2025/assets/css/0.styles.33415ee0.css" as="style"><link rel="preload" href="/w2025/assets/js/app.87c858a9.js" as="script"><link rel="preload" href="/w2025/assets/js/2.ccdb61a5.js" as="script"><link rel="preload" href="/w2025/assets/js/18.7c15b945.js" as="script"><link rel="preload" href="/w2025/assets/js/9.01890ce5.js" as="script"><link rel="preload" href="/w2025/assets/js/11.5fe5a40b.js" as="script"><link rel="prefetch" href="/w2025/assets/js/10.3e691a48.js"><link rel="prefetch" href="/w2025/assets/js/12.f49551e7.js"><link rel="prefetch" href="/w2025/assets/js/13.d5974a84.js"><link rel="prefetch" href="/w2025/assets/js/14.32f7e6e8.js"><link rel="prefetch" href="/w2025/assets/js/15.0ae027c8.js"><link rel="prefetch" href="/w2025/assets/js/16.f2386a1e.js"><link rel="prefetch" href="/w2025/assets/js/17.d7b9d534.js"><link rel="prefetch" href="/w2025/assets/js/19.51980183.js"><link rel="prefetch" href="/w2025/assets/js/20.d519c082.js"><link rel="prefetch" href="/w2025/assets/js/21.362f6b8c.js"><link rel="prefetch" href="/w2025/assets/js/22.afaf2123.js"><link rel="prefetch" href="/w2025/assets/js/23.cdc2c887.js"><link rel="prefetch" href="/w2025/assets/js/24.9b75b7c6.js"><link rel="prefetch" href="/w2025/assets/js/25.e357a328.js"><link rel="prefetch" href="/w2025/assets/js/26.6e814142.js"><link rel="prefetch" href="/w2025/assets/js/27.106c07bd.js"><link rel="prefetch" href="/w2025/assets/js/28.126c37bf.js"><link rel="prefetch" href="/w2025/assets/js/29.ca946c51.js"><link rel="prefetch" href="/w2025/assets/js/3.05989ff3.js"><link rel="prefetch" href="/w2025/assets/js/30.2ba498f6.js"><link rel="prefetch" href="/w2025/assets/js/31.e41d2241.js"><link rel="prefetch" href="/w2025/assets/js/32.cfce5625.js"><link rel="prefetch" href="/w2025/assets/js/33.3dc1268c.js"><link rel="prefetch" href="/w2025/assets/js/34.a3793153.js"><link rel="prefetch" href="/w2025/assets/js/35.ab1290f2.js"><link rel="prefetch" href="/w2025/assets/js/36.3d9064e0.js"><link rel="prefetch" href="/w2025/assets/js/37.2ae4164b.js"><link rel="prefetch" href="/w2025/assets/js/38.195bef2c.js"><link rel="prefetch" href="/w2025/assets/js/39.a9904a96.js"><link rel="prefetch" href="/w2025/assets/js/4.79533d7f.js"><link rel="prefetch" href="/w2025/assets/js/40.1c93503b.js"><link rel="prefetch" href="/w2025/assets/js/41.61991e2b.js"><link rel="prefetch" href="/w2025/assets/js/42.87d5cabf.js"><link rel="prefetch" href="/w2025/assets/js/43.d8a479ef.js"><link rel="prefetch" href="/w2025/assets/js/44.8446907e.js"><link rel="prefetch" href="/w2025/assets/js/45.d1e73d03.js"><link rel="prefetch" href="/w2025/assets/js/46.14dd0c4d.js"><link rel="prefetch" href="/w2025/assets/js/47.6eae941d.js"><link rel="prefetch" href="/w2025/assets/js/48.4b257292.js"><link rel="prefetch" href="/w2025/assets/js/49.7c622f43.js"><link rel="prefetch" href="/w2025/assets/js/5.60adfd1c.js"><link rel="prefetch" href="/w2025/assets/js/50.5cc4788b.js"><link rel="prefetch" href="/w2025/assets/js/51.345ce69e.js"><link rel="prefetch" href="/w2025/assets/js/52.59f792c0.js"><link rel="prefetch" href="/w2025/assets/js/53.9344eea4.js"><link rel="prefetch" href="/w2025/assets/js/6.96402398.js"><link rel="prefetch" href="/w2025/assets/js/7.956989e6.js"><link rel="prefetch" href="/w2025/assets/js/8.62f5a92b.js">
    <link rel="stylesheet" href="/w2025/assets/css/0.styles.33415ee0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/w2025/" class="home-link router-link-active"><img src="/w2025/mad-d-logo-sm.png" alt="MAD9022" class="logo"> <span class="site-name can-hide">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/w2025/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2025/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2025/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/w2025/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2025/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2025/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>PWA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/w2025/modules/pwas/week1/1.1/" class="sidebar-link">1.1: Course Intro &amp; Review</a></li><li><a href="/w2025/modules/pwas/week1/1.2/" class="sidebar-link">1.2: Review Topics</a></li><li><a href="/w2025/modules/pwas/week2/2.1/" class="sidebar-link">2.1: Single Page Applications</a></li><li><a href="/w2025/modules/pwas/week2/2.2/" class="sidebar-link">2.2: SPA &amp; Coding Practices</a></li><li><a href="/w2025/modules/pwas/week3/3.1/" class="sidebar-link">3.1: Workers &amp; Service Workers</a></li><li><a href="/w2025/modules/pwas/week3/3.2/" class="sidebar-link">3.2: Service Worker Events</a></li><li><a href="/w2025/modules/pwas/week4/4.1/" class="sidebar-link">4.1: Messaging</a></li><li><a href="/w2025/modules/pwas/week4/4.2/" class="sidebar-link">4.2: Intro to PWAs</a></li><li><a href="/w2025/modules/pwas/week5/5.1/" aria-current="page" class="active sidebar-link">5.1: PWAs Continued</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week5/5.1/#filtering-cache-matches" class="sidebar-link">Filtering Cache Matches</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week5/5.1/#pwa-project" class="sidebar-link">PWA Project</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week5/5.1/#lighthouse-audits-for-pwa" class="sidebar-link">Lighthouse Audits for PWA</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week5/5.1/#waituntil-skipwaiting-claim" class="sidebar-link">WaitUntil, SkipWaiting, Claim</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week5/5.1/#offline-first" class="sidebar-link">Offline First</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week5/5.1/#launching-native-app-alternative" class="sidebar-link">Launching Native App Alternative</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week5/5.1/#determine-if-website-or-pwa" class="sidebar-link">Determine if Website or PWA</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week5/5.1/#enhanced-install-experiences" class="sidebar-link">Enhanced Install Experiences</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/pwas/week5/5.1/#todo-this-week" class="sidebar-link">ToDo This Week</a></li></ul></li><li><a href="/w2025/modules/pwas/week5/5.2/" class="sidebar-link">5.2: IndexedDB &amp; Data</a></li><li><a href="/w2025/modules/pwas/week6/6.1/" class="sidebar-link">6.1: Hosting Projects</a></li><li><a href="/w2025/modules/pwas/week6/6.2/" class="sidebar-link">6.2: PWA Project</a></li><li><a href="/w2025/modules/pwas/week7/7.1/" class="sidebar-link">7.1: Git Pull Requests</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title red">
    PWA
  </div> <h1>5.1 Building PWAs</h1> <div class="underdev no">Module Still Under Development</div></header> <h2 id="filtering-cache-matches"><a href="#filtering-cache-matches" class="header-anchor">#</a> Filtering Cache Matches</h2> <p>By default, when you save an HTTP Response with the Cache API, if the querystring is different then it will be a separate entry in the Cache. For example, these four urls:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://localhost:3000/index.html?name=steve
http://localhost:3000/index.html?name=tony
http://localhost:3000/index.html?name=adesh
http://localhost:3000/index.html?name=gerry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>will each be saved as a different entry.</p> <p>So, when you want to find a match, you may need to consider or ignore the querystring portion. The cache <code>match</code> and <code>matchAll</code> methods include a options object, that let you modify the search</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'mycache'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/index.html?name=tony'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//find the first match regardless of querystring value</span>
  cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreSearch</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//one match or null</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//find the first match that includes the correct querystring</span>
  cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreSearch</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//one match or null</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//find ALL the matches ignoring the querystring</span>
  cache<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreSearch</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">responses</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//array of all matches</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>The other side of this is the saving process. When you are saving items in the cache maybe you want to strip off the querystring because you don't want to end up with dozens of copies of the same page
in your cache.</p> <p>Say for example the user visits the product's page on the website three times. Each time is to get the details of a different product.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://localhost:3000/products?product_id=123456
http://localhost:3000/products?product_id=765432
http://localhost:3000/products?product_id=999999
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Now, let's assume that the HTML that loads in the page is always the same. After the page loads, a fetch call is made using the product id from the querystring. The fetch call loads the data and
updates the display. Since the original HTML is the same every time and there are potentially thousands of product ids, why would you want to save every copy of the file in the cache, just because the
querystring changes.</p> <p>So, in your service worker, you need to check for the value of the pathname of the URL and create a new URL without the querystring to use as the key for the response.</p> <p>The following example uses the cacheFirst caching strategy</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>pathname <span class="token operator">==</span> <span class="token string">'/products'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//request for the /products page</span>
    ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
      caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'mycache'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreSearch</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">||</span>
          <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fetchResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> copy <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//remove the querystring</span>
            url<span class="token punctuation">.</span>searchParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//save in the cache with emptied querystring</span>
            cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//return the fetched file</span>
            <span class="token keyword">return</span> fetchResponse<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//all other requests... just pass through</span>
    ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>So, now if the user visits the <code>/products</code> page, we check the cache first. If the file is there (ignoring the querystring value of the request), then return the cached file.</p> <p>If the file is not in the cache, then fetch the file, create a clone copy of the response and save it in the cache using the same URL but without the querystring. The original file response gets sent
back to the browser.</p> <h2 id="pwa-project"><a href="#pwa-project" class="header-anchor">#</a> PWA Project</h2> <p>To build a PWA there are a number of things that we need to include.</p> <ol><li>A <code>manifest.json</code> file that defines all the settings, base colours, and icons for the App which can be used when installed.</li> <li>The icons outlined in the <code>manifest.json</code> file.</li> <li>CSS to create a responsive design for the app.</li> <li>A service worker that handles all the HTTP Requests made by the web page.</li> <li>Cache that holds copies of files to be used when the App is offline.</li> <li>A 404 type page is stored in the Cache, which you can display if a link to a web page is clicked and that link is not in your cache.</li></ol> <h2 id="lighthouse-audits-for-pwa"><a href="#lighthouse-audits-for-pwa" class="header-anchor">#</a> Lighthouse Audits for PWA</h2> <p>Lighthouse is an Audit tool built into the Chrome Web Dev tools which let's you know if your website meets all the requirements for being a Progressive Web App.</p> <p>Open the Chrome Dev tools and look for the <code>Lighthouse</code> tab. It can run a number of tests. However, the category we want is the <code>Progressive Web App</code> one. Only select that checkbox and then click the
<strong>Generate Report</strong> button.</p> <p><img src="/w2025/assets/img/lighthouse-screenshot.6594d7ac.png" alt="Lighthouse tab in Chrome Dev Tools"></p> <p>As you can see in the above screenshot, there are other options for lighthouse reports too. The Mode that you will use for nearly everything is <code>Navigation</code>. This asks the browser to try and navigate
through your site, like a user would.</p> <p>Under the <code>Categories</code> heading you will see options:</p> <ul><li>Performance: to test for loading times and interaction times. This will help with SEO and user experience.</li> <li>Accessibility: to make sure that you are meeting accessibility guidelines.</li> <li>Best Practices: a combination of factors across the different categories.</li> <li>SEO: specifically things that will help your ranking and search matching.</li> <li>Progressive Web App: testing to make sure you are meeting the requirements to install your site as a PWA.</li></ul> <p>It will take a minute or two to run the report.</p> <p>The results are split into three groups.</p> <ol><li>Fast and Reliable</li> <li>Installable</li> <li>PWA Optimized</li></ol> <p>We want green checkmarks || circles for everything!</p> <p><a href="https://developer.chrome.com/docs/lighthouse/overview" target="_blank" rel="noopener noreferrer">Here is the Web.dev guide to the Lighthouse Panel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>The official <a href="https://developer.chrome.com/docs/devtools/progressive-web-apps/" target="_blank" rel="noopener noreferrer">Web.dev guide to devtools and Progressive Web Apps<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> can be read to understand more of the features under the dev tools
<code>Application</code> tab.</p> <p>The Lighthouse PWA test will be removed at some point in the future, in favour of the Application tab.</p> <blockquote><p>Just like Service Workers, PWAs need <code>https</code> to work but they are allowed to run on <code>localhost</code> or <code>127.0.0.1</code> without it.</p></blockquote> <p><a href="https://developer.chrome.com/blog/update-install-criteria" target="_blank" rel="noopener noreferrer">Here is the Official Installability Requirements Guide for PWAs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="waituntil-skipwaiting-claim"><a href="#waituntil-skipwaiting-claim" class="header-anchor">#</a> WaitUntil, SkipWaiting, Claim</h2> <p>The <code>install</code>, <code>activate</code>, <code>fetch</code>, and <code>message</code> events are all <code>ExtendableEvents</code>. That means we can use the <code>ev.waitUntil()</code> method to delay the completion of our event listener function until
after a Promise has resolved.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>ev<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//function that runs and does something that could take some time</span>
    <span class="token comment">//when we are done we call:</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//which will pass our result back to the waitUntil method</span>
    <span class="token comment">// as a resolved Promise object.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div title="WaitUntil, SkipWaiting, Claim" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/nhkpOK3NfW0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <p>The <code>self.skipWaiting()</code> method tells the service worker that it does not need to wait to be activated. It should skip the <code>waiting</code> phase and immediately start activating. This will trigger the
<code>activate</code> event listener function.</p> <p>It is important to remember that the web page still will not be communicating with the new service worker. It still thinks that the old service worker is running.</p> <p>This brings us to the <code>clients.claim()</code> method, which, if run inside the <code>activate</code> event listener function, will find all the windows and tabs that are currently running and tell them that the new
service worker is activated and should be referenced now.</p> <h2 id="offline-first"><a href="#offline-first" class="header-anchor">#</a> Offline First</h2> <p>The window object and the Service Worker scope, both have an <code>online</code> and <code>offline</code> event that we can listen for.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//in main.js</span>
<span class="token comment">//listen for on and off line events</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//tell the service worker about the change to online</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//tell the service worker about the change to offline</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//instead, in the sw.js file you will check the current onLine status inside the fetch listener</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//browser has made an HTTP Request</span>
  <span class="token keyword">const</span> isOnline <span class="token operator">=</span> self<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>onLine<span class="token punctuation">;</span>
  <span class="token comment">//isOnline is a Boolean indicating if the user is definitely offline</span>
  <span class="token comment">// or is at least connected to wi-fi.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>The <code>online</code> and <code>offline</code> event is fairly dependable for telling us that a connection to the wi-fi network has been established or lost. However, it does NOT tell us about failures for the wi-fi
network to actually get online. It also does NOT tell us if our connection is really poor. A one-bar connection to a network is still considered &quot;online&quot;.</p> <p>The default value for this can be found in the <code>navigator</code> object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> isOnline <span class="token operator">=</span> <span class="token string">'onLine'</span> <span class="token keyword">in</span> navigator <span class="token operator">&amp;&amp;</span> navigator<span class="token punctuation">.</span>onLine<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The example above, checks for existence of the <code>onLine</code> property and then find it's Boolean value. This property is available in BOTH the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window" target="_blank" rel="noopener noreferrer">global window scope<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and the <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope" target="_blank" rel="noopener noreferrer">ServiceWorkerGlobalScope<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which
inherits properties from the <a href="https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope" target="_blank" rel="noopener noreferrer">GlobalWorkerScope<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div title="online, offline, or wtf" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/45so6LA8wRY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <p>It is important to remember that the Service Workers do <strong>NOT</strong> retain their state after being shut down by the browser. This is why we need to save info in the Cache or IndexedDB.</p> <p>So, while we can listen for changes in the online status, it is best to check the current value in the <code>navigator.onLine</code> property.</p> <p>As an example, let's say that you have a service worker whose <code>fetch</code> event listener function needs to determine the online status to choose between the cache and doing an actual fetch. The <code>navigator.onLine</code> property will give us a generally good idea if we are connected to the internet. From this value we know when we are completely disconnected or if we have a live connection to a router or wi-fi hub.</p> <p>Unfortunately, it does not tell us if we have a terrible connection. We don't know if we have a 5G connection to the ISP with 1.5Gbps connection speed or a 2400 bps connection with a 1996 dialup modem. Developers will sometimes refer to this as Lie-fi instead of Wi-fi.</p> <p>To solve the issue, we can attempt to reach an endpoint on some server in the most efficient way possible.</p> <h3 id="more-accuracy-through-testing"><a href="#more-accuracy-through-testing" class="header-anchor">#</a> More Accuracy Through Testing.</h3> <p>We can make a fetch call from either the webpage or our Service Worker that uses the <code>HEAD</code> method instead of <code>GET</code> or <code>POST</code>, just to see if we get a response.</p> <p>Use an endpoint that is guaranteed to be available, or use a test of your own API. Have a health check route that returns minimal data or accepts the <code>HEAD</code> method. If you get a <strong>VALID</strong> response
from the server then that can be used as proof of being online.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">isConnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'/api/alive'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'HEAD'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>You will have to edit the above code sample to use a proper URL to test.</p> <p>We can also add the check for <code>navigator.onLine</code> into this function.</p> <p>And, if you really want to, you can add a time limit of a certain number of milliseconds without a response to treat the online test as a failure. This extra time limit step is not usually required.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">isConnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//can only be called from INSIDE an ev.respondWith()</span>
  <span class="token keyword">const</span> maxWait <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span> <span class="token comment">//if it takes more than x milliseconds</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>onLine<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//immediate response if offline</span>
  <span class="token comment">//exit if already known to be offline</span>
  <span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://jsonplaceholder.typicode.com/users/1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'HEAD'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> t1 <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> t2 <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> timeDiff <span class="token operator">=</span> t2 <span class="token operator">-</span> t1<span class="token punctuation">;</span>
      <span class="token comment">// console.log({ timeDiff });</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok <span class="token operator">||</span> timeDiff <span class="token operator">&gt;</span> maxWait<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//true if navigator online and the HEAD request worked</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//the fetch failed or the response was not valid</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="launching-native-app-alternative"><a href="#launching-native-app-alternative" class="header-anchor">#</a> Launching Native App Alternative</h2> <p>If you have a true Native application and you want to have the user be prompted to install a platform specific native version as an alternative to your PWA then you can update the web manifest file to
have the mobile device prompt the user with their choices.</p> <p>We have to add the following two settings in the web manifest file.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;prefer_related_applications&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;related_applications&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;platform&quot;</span><span class="token operator">:</span> <span class="token string">&quot;play&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://play.google.com/store/apps/details?id=com.example.app1&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;com.example.app1&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;platform&quot;</span><span class="token operator">:</span> <span class="token string">&quot;itunes&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://itunes.apple.com/app/example-app1/id123456789&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>If there is no native alternative then omit the <code>prefer_related_applications</code> setting or have it set to <code>false</code>.</p> <h2 id="determine-if-website-or-pwa"><a href="#determine-if-website-or-pwa" class="header-anchor">#</a> Determine if Website or PWA</h2> <p>We can actually determine whether our web app is running as a basic website that has a service worker or if it was launched as a PWA.</p> <p>Use the following script to determine the load context and add any custom code based on those circumstances.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//check if the app was launched from installed version</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>standalone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Launched: Installed (iOS)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">APP</span><span class="token punctuation">.</span>isStandalone <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">matchMedia</span><span class="token punctuation">(</span><span class="token string">'(display-mode: standalone)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>matches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Launched: Installed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">APP</span><span class="token punctuation">.</span>isStandalone <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log('Launched: Browser Tab');</span>
  <span class="token constant">APP</span><span class="token punctuation">.</span>isStandalone <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div title="PWA determine launch source" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/Fcc18-zLwTM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <p>There is also a way that we can listen for changes to the <code>display-mode</code>. We can add an event listener to the <code>window.matchMedia</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">matchMedia</span><span class="token punctuation">(</span><span class="token string">'(display-mode: standalone)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> displayMode <span class="token operator">=</span> <span class="token string">'browser'</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>evt<span class="token punctuation">.</span>matches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    displayMode <span class="token operator">=</span> <span class="token string">'standalone'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Log display mode change to analytics</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DISPLAY_MODE_CHANGED'</span><span class="token punctuation">,</span> displayMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="enhanced-install-experiences"><a href="#enhanced-install-experiences" class="header-anchor">#</a> Enhanced Install Experiences</h2> <p>With a Chrome based browser we have access to that <a href="/w2025/modules/pwas/week5/week10/#handling-install-events-in-chrome">deferred install prompt event discussed last week</a>.</p> <p>When we feel that it is a good time to ask the user to install we used this code to prompt them:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">APP</span><span class="token punctuation">.</span>deferredPrompt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">APP</span><span class="token punctuation">.</span>deferredPrompt<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">APP</span><span class="token punctuation">.</span>deferredPrompt<span class="token punctuation">.</span>userChoice<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">choiceResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>choiceResult<span class="token punctuation">.</span>outcome <span class="token operator">===</span> <span class="token string">'accepted'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User accepted the install prompt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User dismissed the install prompt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>This will display the built-in install prompt on non-iPhone Chrome, Opera, and Edge browsers.</p> <h3 id="how-you-can-ask-users-to-install"><a href="#how-you-can-ask-users-to-install" class="header-anchor">#</a> How you can Ask Users to Install</h3> <p>There are a number of ways that we can encourage a user to install.</p> <p>Remember, asking them too early will drive most people to ignore the option from that point onward.</p> <ol><li>A simple install button on the page. Put the button in an obvious location. Be sure to add some explanatory text about what install means. You can put this button near the bottom of the page or in
a location that appears after they have already interacted with some content on your site.</li> <li>An install button in the header of each page. Make it part of the navigation options.</li> <li>If you have a slide out navigation menu, put it at the bottom of the menu.</li> <li>A custom install banner. Have a look at the install banner that comes with chrome. Use this as a basis for creating your own styled banner that appears in any browser.</li> <li>A dismissible Snackbar near the bottom of the page. Try not to interfere with any task that the user would be trying to accomplish. You want to be noticeable without being annoying. Remember to
wait long enough before displaying.</li> <li>If there is an ordering or checkout process in your app then having an install option here is an excellent choice. As they finish their order and you are thanking them and providing a tracking
number, remind them that they can install your app and give them some reasons why they might want to.</li></ol> <p>For all of these options you have the ability to style the button to match the style of the rest of your site.</p> <p>For any of these install prompts you will need to have a screen where you outline to users, who will nearly always be less technically savvy than you, how to actually install the app.</p> <p>Read more about encouraging users to install <a href="https://web.dev/promote-install/" target="_blank" rel="noopener noreferrer">on web.dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and more about <a href="https://web.dev/customize-install/" target="_blank" rel="noopener noreferrer">building your own install ui<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Read more about the <a href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Developer_guide/Installing" target="_blank" rel="noopener noreferrer">install process for users on different platforms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="todo-this-week"><a href="#todo-this-week" class="header-anchor">#</a> ToDo This Week</h2> <div class="custom-block danger"><p class="custom-block-title">To Do this week</p> <ul><li>read all the content for modules 5.1 and 5.2</li> <li>Complete and submit <a href="/w2025/modules/hybrids/exercises.html">Hybrid Web Component Exercise</a>.</li></ul></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/w2025/modules/pwas/week4/4.2/" class="prev">
        4.2: Intro to PWAs
      </a></span> <span class="next"><a href="/w2025/modules/pwas/week5/5.2/">
        5.2: IndexedDB &amp; Data
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/w2025/assets/js/app.87c858a9.js" defer></script><script src="/w2025/assets/js/2.ccdb61a5.js" defer></script><script src="/w2025/assets/js/18.7c15b945.js" defer></script><script src="/w2025/assets/js/9.01890ce5.js" defer></script><script src="/w2025/assets/js/11.5fe5a40b.js" defer></script>
  </body>
</html>
